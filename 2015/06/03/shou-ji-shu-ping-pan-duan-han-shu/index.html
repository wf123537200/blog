
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>微信横屏问题</title>
    <meta name="description" content="移动端横屏问题讨论，微信屏幕旋转问题解决">
    <meta name="HandheldFriendly" content="True">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="baidu-site-verification" content="1B8AemIXSQ">
    <!--[if lte IE 9]><meta http-equiv="refresh" content="0;url=/ie.html"><![endif]-->
    <link rel="canonical" href="http://127.0.0.1/2015/06/03/shou-ji-shu-ping-pan-duan-han-shu/">
    
    <meta property="og:site_name" content="zakwu的成长记录">
    <meta property="og:type" content="article">
    <meta property="og:title" content="微信横屏问题">
    <meta property="og:description" content="移动端横屏问题讨论，微信屏幕旋转问题解决...">
    <meta property="og:url" content="http://127.0.0.1/2015/06/03/shou-ji-shu-ping-pan-duan-han-shu/">
    <meta property="article:published_time" content="2015-06-03T10:14:59.000Z">
    <meta property="article:modified_time" content="2015-06-04T14:12:27.000Z">
    <meta property="article:tag" content="css">
    <meta property="article:tag" content="js">
    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="微信横屏问题">
    <meta name="twitter:description" content="移动端横屏问题讨论，微信屏幕旋转问题解决...">
    <meta name="twitter:url" content="http://127.0.0.1/2015/06/03/shou-ji-shu-ping-pan-duan-han-shu/">
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "zakwu的成长记录",
    "author": {
        "@type": "Person",
        "name": "zakwu",
        "url": "http://127.0.0.1/author/zakwu",
        "sameAs": null
    },
    "headline": "微信横屏问题",
    "url": "http://127.0.0.1/2015/06/03/shou-ji-shu-ping-pan-duan-han-shu/",
    "datePublished": "2015-06-03T10:14:59.000Z",
    "dateModified": "2015-06-04T14:12:27.000Z",
    "keywords": "css, js",
    "description": "移动端横屏问题讨论，微信屏幕旋转问题解决..."
}
    </script>

    <meta name="generator" content="Ghost 0.5">
    <link rel="alternate" type="application/rss+xml" title="zakwu的成长记录" href="http://127.0.0.1/rss/">

    <!-- link -->
    <link rel="shortcut icon" href="../../../../favicon.ico">
    <link rel="stylesheet" type="text/css" href="../../../../assets/css/style.css">
  </head>
  <body>
    <aside id="sidebar">
      <nav id="tags">
        <a href="http://zakwu.me/node/assets/about/about.html" target="_blank" title="about me" id="avatar"></a>

        <ul id="tags__ul">
          <!--&lt;!&ndash; connect &ndash;&gt;-->
          <!--<li id="sthfuns" class="tags__li tags-btn">作品集</li>-->
          <!--<li id="shareppt" class="tags__li tags-btn">分享ppt</li>-->

          <!-- acts -->
          <li id="js-label1" class="tags__li tags-btn active">全部文章</li>
          <li id="js-label2" class="tags__li tags-btn">ghost</li>
          <li id="js-label3" class="tags__li tags-btn">js 技术</li>
          <li id="js-label4" class="tags__li tags-btn">css 技术</li>
          <li id="js-label5" class="tags__li tags-btn">前端架构</li>
          <li id="js-label6" class="tags__li tags-btn">心随意转</li>
        </ul>

        <div id="tags__bottom">
          <a href="http://github.com/wf123537200/" target="_blank" class="tags-btn show-icon-right fa fa-github" title="加我github"></a>
          <a href="http://zakwu.me/node/assets/about/about.html" target="_blank" class="tags-btn show-icon-right fa fa-user" title="关于我"></a>
          <a href="mailto:wfsheep@163.com" title="给我邮件" class="tags-btn show-icon-right fa fa-envelope-o"></a>
          <a href="http://zakwu.me/rss/" title="订阅我的blog" class="tags-btn fa fa-rss"></a>
        </div>
      </nav> <!-- end #tags -->

      <div id="posts-list">
        <form action="index.html" id="search-form">
          <a href="http://127.0.0.1" id="mobile-avatar"></a>
          <!-- NOTE: input field is disabled by default -->
          <input id="search-input" type="text" placeholder="Search...">
        </form>

        <nav id="pl__container">
        </nav>
      </div> <!-- end #posts-list -->
    </aside> <!-- end #sidebar -->

    <div id="post">
      <div id="pjax">
        
    <article id="post__content">
      <h1 id="post__title" data-identifier="20150603">微信横屏问题</h1>
      <p>移动端html开发，我们常会用到横竖屏的判断做一些事情，比如说播放视频的时候时常使用横竖屏切来切换居中显示和全屏显示，如果你无数次尝试都失败了，请你看到最后，有惊喜哦！！。</p>

<p>一般来说，横竖屏的检测方式有以下几种：</p>

<h3 id="">一、使用浏览器自带的事件</h3>

<p>使用浏览器自带事件orientationchange和浏览器对象window.orientation可以完美进行横竖屏幕切换。根据参考资料一，此事件在有些浏览器中使用绑定在body元素上的属性来实现，只有在页面发生css重排后才会被触发。解决此问题的方法是在body上增加一个css类，用来触发css的重排，具体css代码如下：</p>

<pre><code class="language-css">.portrait body div { width: 10%; }
.landscape body div { width: 15%; }
</code></pre>

<p>调用事件代码如下：</p>

<pre><code class="language-javascript">  var updateOrientation = function() {
    var orientation = window.orientation;

    switch(orientation) {
      case 90: case -90:
        orientation = 'landscape';
      break;
      default:
        orientation = 'portrait';
    }

    // set the class on the HTML element (i.e. )
    document.body.parentNode.setAttribute('class', orientation);
  };

  // event triggered every 90 degrees of rotation
  window.addEventListener('orientationchange', updateOrientation, false);
</code></pre>

<h3 id="2mediaquery">2、使用媒体查询（media query）</h3>

<p>媒体查询里面中有横竖屏幕的检测，orientation: portrait(竖)/landscape(横)，媒体查询该属性的生效系统版本为：iOS 3.2+, Android 2.0+和一些其他浏览器。
具体代码如下：</p>

<pre><code class="language-css">@media all and (orientation: portrait) {
  body div { width: 10%; }
}

@media all and (orientation: landscape) {
  body div { width: 15%; }
}
</code></pre>

<h3 id="3">3、使用定时器，定期检测当前页面的长宽</h3>

<p>此种方法通过定时检测当前页面的长宽，通过对比长宽，对其进行判断，根据判断结果模拟页面的横竖屏，此方法性能堪忧，主要用于以上1,2均不支持的浏览器或者手机。废话少说，上代码。</p>

<pre><code class="language-javascript">    var updateOrientation = function() {
        // landscape when width is biggest, otherwise portrait
        var orientation = (window.innerWidth &gt; window.innerHeight) ? 'landscape': 'portrait';

        // set the class on the HTML element (i.e. )
        document.body.parentNode.setAttribute('class', orientation);
    };

    // initialize the orientation
    updateOrientation();

    // update every 5 seconds
    setInterval(updateOrientation, 5000);
</code></pre>

<h3 id="4">4、横屏终结版</h3>

<p>综上，产生了横屏终结版。代码如下：</p>

<pre><code class="language-javascript">  (function(){
    var supportsOrientation = (typeof window.orientation == 'number' &amp;&amp; typeof window.onorientationchange == 'object');
    var HTMLNode = document.body.parentNode;
    var updateOrientation = function() {
      // rewrite the function depending on what's supported
      if(supportsOrientation) {
        updateOrientation = function() {
          var orientation = window.orientation;

          switch(orientation) {
            case 90: case -90:
              orientation = 'landscape';
            break;
            default:
              orientation = 'portrait';
          }

          // set the class on the HTML element (i.e. )
          HTMLNode.setAttribute('class', orientation);
        }
      } else {
        updateOrientation = function() {
          // landscape when width is biggest, otherwise portrait
          var orientation = (window.innerWidth &gt; window.innerHeight) ? 'landscape': 'portrait';

          // set the class on the HTML element (i.e. )
          HTMLNode.setAttribute('class', orientation);
        }
      }

      updateOrientation();
    }
    var init = function() {
      // initialize the orientation
      updateOrientation();

      if(supportsOrientation) {
        window.addEventListener('orientationchange', updateOrientation, false);
      } else {
        // fallback: update every 5 seconds
        setInterval(updateOrientation, 5000);
      }

    }
    window.addEventListener('DOMContentLoaded', init, false);
  })();
</code></pre>

<p><strong style="color:red">温馨提示: 1、如果移动端所有浏览器都失效，请检查手机屏幕旋转是否开启；2、如果只有微信旋转失效，而在浏览器中打开正常，请打开微信的【开启横屏模式】；3、如果以上两条都无法解决，请检查人品。</strong></p>

<h3 id="5">5、参考资料</h3>

<p><a href="http://davidbcalhoun.com/2010/dealing-with-device-orientation/">国外大神移动端研究</a></p>

<p><strong>更多内容请查看<a href="http://zakwu.me/2015/06/03/shou-ji-shu-ping-pan-duan-han-shu/">zakwu的小站</a></strong></p>
    </article> <!-- end #post__content -->

    <!--<div id="post__share">-->
      <!--<a id="icon-twitter" href="https://twitter.com/intent/tweet?url=http://127.0.0.1/2015/06/2015/06/03/shou-ji-shu-ping-pan-duan-han-shu/&text=微信横屏问题" target="_blank"></a>-->
      <!--<a id="icon-cc" href="http://creativecommons.org/licenses/by-nc-sa/3.0" target="_blank"></a>-->
      <!--<a id="icon-weibo" href="http://v.t.sina.com.cn/share/share.php?url=http://127.0.0.1/2015/06/2015/06/03/shou-ji-shu-ping-pan-duan-han-shu/&title=微信横屏问题" target="_blank"></a>-->
    <!--</div> &lt;!&ndash; end #post__share &ndash;&gt;-->
    <div id="dsData" data-id="9" data-title="微信横屏问题" data-url="/2015/06/03/shou-ji-shu-ping-pan-duan-han-shu/"></div>
    <!--PC版-->
    <div id="cyss" sid="/2015/06/03/shou-ji-shu-ping-pan-duan-han-shu/"></div>
    <div id="SOHUCS" sid="/2015/06/03/shou-ji-shu-ping-pan-duan-han-shu/"></div>

      </div> <!-- end #pjax -->

      <div id="post__toc-trigger">
        <div id="post__toc">
          <span id="post__toc-title">Table of Contents</span>
          <ul id="post__toc-ul"></ul>
        </div>
      </div>
    </div> <!-- end #post -->

    <!-- 收缩箭头 -->
    <button id="js-fullscreen"><span class="fa fa-chevron-right" id="icon-arrow"></span></button>

    <footer>
      <div>Powered by <a href="https://ghost.org" target="_blank">Ghost</a>  |  ©zak wu 2015<a href="http://www.miitbeian.gov.cn/">粤ICP备15007095</a></div>
    </footer>

    <script src="../../../../assets/js/jquery-2.0.3.min.js"></script>
    <script src="../../../../assets/js/jquery.pjax.js"></script>
    <script src="../../../../assets/js/nprogress.js"></script>
    <script src="../../../../assets/js/prism.js"></script>
    <script src="../../../../assets/js/script.js"></script>
    <script src="../../../../public/jquery.js?v=8414ae6066"></script>
  </body>
